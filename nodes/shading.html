<!-- TODOS

    * i18n
    * Passende fa icons
    * Open / Close setpos konfigurierbar machen
    * lat/lon Eingabeformat, passt das so?
 -->




 <script type="text/javascript">
    RED.nodes.registerType("shading location", {
        category: "config",
        defaults: {
            name: {},
            lat: {value: "", required: true, validate:RED.validators.number()},
            lon: {value: "", required: true, validate:RED.validators.number()},
        },
        label: function() {
            return this.name || this.lat + " / " + this.lon
        }
    })
</script>

<script type="text/html" data-template-name="shading location">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-bookmark"></i> Name</span></label>
        <input type="text" id="node-config-input-name" placeholder="Home, Apartment, Cabin, ...">
    </div>
    <div class="form-row">
        <label for="node-config-input-lat"><i class="fa fa-compass"></i> Latitude</label>
        <input type="text" id="node-config-input-lat" placeholder="47.4791446">
    </div>
    <div class="form-row">
        <label for="node-config-input-lon"><i class="fa fa-compass"></i> Longitude</label>
        <input type="text" id="node-config-input-lon" placeholder="9.6631092">
    </div>
    <div class="form-tips">
        <h2>Name</h2>
        <p>Give the location a name. You probably may have only one location config in your project, so you may name it 'Home' or simply leave it blank to use the coordinates as name.</p>
        <h2>Latitude, Longitude (DD)</h2>
        <p>Coordinates of your installation in decimal degrees (DD). There are plenty of mobile apps displaying you the coordinates in various formats. You may start trying the pre-installed compass app first. There's a <a href="https://support.google.com/maps/answer/18539" target="_blank">domestic article by Google</a> how to use maps to find coordinates of a specific location. On <a href="https://www.openstreetmap.org" target="_blank">OpenStreetMap</a>, simply rightclick the point of your interest and choose 'show adress' to see the information like coordinates in a side panel.</p>
    </div>
</script>






<script type="text/javascript">
    RED.nodes.registerType('shading orientation',{
        category: 'config',
        defaults: {
            name: {},
            config: {type: "shading location"},
            direction: {required: true},
        },
        label: function() {
            return this.name || this.direction + "°";       // TODO: automatisch zusammenstellen: shading location.name + orientation
        }
    })
</script>

<script type="text/html" data-template-name="shading orientation">
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-bookmark"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="East, Streetside, Garden, ...">
    </div>
    <div class="form-row">
        <label for="node-config-input-config"><i class="fa fa-compass"></i> Location</label>
        <input type="text" id="node-config-input-config">
    </div>
    <div class="form-row">
        <label for="node-config-input-direction"><i class="fa fa-location-arrow"></i> Direction</label>
        <input type="number" id="node-config-input-direction" style="width:100px" placeholder="0 - 359" min="0" max="359"> °
    </div>
    <div class="form-tips">
        <h2>Name</h2>
        <p>Give the orientation a name or simply leave it blank to use the entered number as identifier. If you have a room with one window, you may want to give it the room's name (like 'livingroom'). If you have more windows in a room, you may use an identifier (like 'left' or 'right').</p>
        <h2>Location</h2>
        <p>We need to know the location of the facility where the shading operates. This is important when it comes sun or weather relevant functions.</p>
        <h2>Direction</h2>
        <p>Use a regular compass, the compass app on your mobile or try to determine the orientation on a map like <a href="https://www.openstreetmap.org" target="_blank">OpenStreetMap</a> or <a href="https://maps.google.com" target="_blank">Google Maps</a>. The value must be a number in degrees >= 0 and < 360.</p>
    </div>
</script>





<script type="text/javascript">
    RED.nodes.registerType ('shading configuration', {
        category: 'config',
        defaults: {
            name: {required: true},
            windowSunAngleEntry: {value: -75, required: true},
            windowSunAngleExit: {value: 75, required: true},
            shadingSetposOpen: {value: "initval", required: true},  // WORKAROUND: requires "initval" because if 0, the field is left blank.
            shadingSetposOpenType: {value: "initval"},
            shadingSetposShade: {value: 80, required: true},
            shadingSetposShadeType: {value: "initval"},
            shadingSetposClose: {value: 100, required: true},
            shadingSetposCloseType: {value: "initval"},
            inmsgButtonTopicOpen: {},
            inmsgButtonPayloadOpen: {value: "true", validate: RED.validators.typedInput("buttonPayloadOpenType")},
            inmsgButtonPayloadOpenType: {value: "initval"},
            inmsgButtonTopicClose: {},
            inmsgButtonPayloadClose: {value: "true", validate: RED.validators.typedInput("buttonPayloadCloseType")},
            inmsgButtonPayloadCloseType: {value: "initval"},
            behButtonLocksUntil: {value: "initval"},
            inmsgWinswitchTopic: {value: "switch"},
            inmsgWinswitchPayloadOpened: {value: 1},
            inmsgWinswitchPayloadOpenedType: {value: "initval"},
            inmsgWinswitchPayloadTilted: {value: 2},
            inmsgWinswitchPayloadTiltedType: {value: "initval"},
            inmsgWinswitchPayloadClosed: {value: 3},
            inmsgWinswitchPayloadClosedType: {value: "initval"},
            behSunrise: {value: "initval"},
            behSunset: {value: "initval"}
        },
        label: function() {
            return this.name
        },
        oneditprepare: function() {
            // value & type initialisation
            if (this.shadingSetposOpen === "initval") {
                $("#node-config-input-shadingSetposOpen").val(0)
            }
            if (this.shadingSetposOpenType === "initval") {
                $("#node-config-input-shadingSetposOpenType").val("num")
            }
            if (this.shadingSetposShadeType === "initval") {
                $("#node-config-input-shadingSetposShadeType").val("num")
            }
            if (this.shadingSetposCloseType === "initval") {
                $("#node-config-input-shadingSetposCloseType").val("num")
            }
            if (this.inmsgButtonPayloadOpenType === "initval") {
                $("#node-config-input-inmsgButtonPayloadOpenType").val("bool")
            }
            if (this.inmsgButtonPayloadCloseType === "initval") {
                $("#node-config-input-inmsgButtonPayloadCloseType").val("bool")
            }
            if (this.inmsgWinswitchPayloadOpenedType === "initval") {
                $("#node-config-input-inmsgWinswitchPayloadOpenedType").val("num")
            }
            if (this.inmsgWinswitchPayloadTiltedType === "initval") {
                $("#node-config-input-inmsgWinswitchPayloadTiltedType").val("num")
            }
            if (this.inmsgWinswitchPayloadClosedType === "initval") {
                $("#node-config-input-inmsgWinswitchPayloadClosedType").val("num")
            }
            if (this.behSunrise === "initval") {
                $("#node-config-input-behSunrise").val("nothing")
            }
            if (this.behSunset === "initval") {
                $("#node-config-input-behSunset").val("nothing")
            }
            if (this.behButtonLocksUntil === "initval") {
                $("#node-config-input-behButtonLocksUntil").val("sunriseset")
            }
            // defining input types
            $("#node-config-input-shadingSetposOpen").typedInput({
                default: "num",
                typeField: $("#node-config-input-shadingSetposOpenType"),
                types: ["num"]
            })
            $("#node-config-input-shadingSetposShade").typedInput({
                default: "num",
                typeField: $("#node-config-input-shadingSetposShadeType"),
                types: ["num"]
            })
            $("#node-config-input-shadingSetposClose").typedInput({
                default: "num",
                typeField: $("#node-config-input-shadingSetposCloseType"),
                types: ["num"]
            })
            $("#node-config-input-inmsgButtonPayloadOpen").typedInput({
                default: "bool",
                typeField: $("#node-config-input-inmsgButtonPayloadOpenType"),
                types: ["bool","num","str"]
            })
            $("#node-config-input-inmsgButtonPayloadClose").typedInput({
                default: "bool",
                typeField: $("#node-config-input-inmsgButtonPayloadCloseType"),
                types: ["bool","num","str"]
            })
            $("#node-config-input-inmsgWinswitchPayloadOpened").typedInput({
                default: "num",
                typeField: $("#node-config-input-inmsgWinswitchPayloadOpenedType"),
                types: ["bool","num","str"]
            })
            $("#node-config-input-inmsgWinswitchPayloadTilted").typedInput({
                default: "num",
                typeField: $("#node-config-input-inmsgWinswitchPayloadTiltedType"),
                types: ["bool","num","str"]
            })
            $("#node-config-input-inmsgWinswitchPayloadClosed").typedInput({
                default: "num",
                typeField: $("#node-config-input-inmsgWinswitchPayloadClosedType"),
                types: ["bool","num","str"]
            })
            $("#node-config-input-behSunrise").typedInput({
                types: [
                    {
                        value: "behSunrise",
                        options: [
                            {value: "nothing", label: "Nothing"},
                            {value: "open", label: "Open"},
                            {value: "shade", label: "Shade"},
                            {value: "close", label: "Close"}
                        ]
                    }
                ]
            })
            $("#node-config-input-behSunset").typedInput({
                types: [
                    {
                        value: "behSunset",
                        options: [
                            {value: "nothing", label: "Nothing"},
                            {value: "open", label: "Open"},
                            {value: "shade", label: "Shade"},
                            {value: "close", label: "Close"}
                        ]
                    }
                ]
            })
            $("#node-config-input-behButtonLocksUntil").typedInput({
                types: [
                    {
                        value: "behButtonLocksUntil",
                        options: [
                            {value: "sunriseset", label: "Next sunrise / sunset"},
                            {value: "manualreset", label: "Manual reset"}       // TODO describe how to manually reset
                        ]
                    }
                ]
            })
        }
    })
</script>

<script type="text/html" data-template-name="shading configuration">
    <style>
        .red-ui-editor .form-row label {
            width: 130px
        }
        .red-ui-editor .form-row input {
            width: 250px
        }
        .red-ui-editor .form-row #node-config-input-windowSunAngleEntry,
        .red-ui-editor .form-row #node-config-input-windowSunAngleExit,
        .red-ui-editor .form-row #node-config-input-shadingSetposOpen,
        .red-ui-editor .form-row #node-config-input-shadingSetposShade,
        .red-ui-editor .form-row #node-config-input-shadingSetposClose {
            width: 100px
        }
    </style>
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-bookmark"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name of onfiguration set">
    </div>
    <h3>Sun configuration</h3>
    <div class="form-row">
        <label for="node-config-input-windowSunAngleEntry"><i class="fa fa-location-arrow"></i> Entry angle</label>
        <input type="number" id="node-config-input-windowSunAngleEntry" placeholder="-90 - 0" min="-90" max="0"> °
    </div>
    <div class="form-row">
        <label for="node-config-input-windowSunAngleExit"><i class="fa fa-location-arrow"></i> Exit angle</label>
        <input type="number" id="node-config-input-windowSunAngleExit" placeholder="0 - 90" min="0" max="90"> °
    </div>
    <h3>Blind configuration</h3>
    <div class="form-row">
        <label for="node-config-input-shadingSetposOpen"><i class="fa fa-window-maximize"></i> Open position</label>
        <input type="hidden" id="node-config-input-shadingSetposOpenType">
        <input type="text" id="node-config-input-shadingSetposOpen"> %
    </div>
    <div class="form-row">
        <label for="node-config-input-shadingSetposShade"><i class="fa fa-window-maximize"></i> Shade position</label>
        <input type="hidden" id="node-config-input-shadingSetposShadeType">
        <input type="text" id="node-config-input-shadingSetposShade"> %
    </div>
    <div class="form-row">
        <label for="node-config-input-shadingSetposClose"><i class="fa fa-window-maximize"></i> Close position</label>
        <input type="hidden" id="node-config-input-shadingSetposCloseType">
        <input type="text" id="node-config-input-shadingSetposClose"> %
    </div>
    <h3>Pushbutton configuration</h3>
    <div class="form-row">
        <label for="node-config-input-behButtonLocksUntil"><i class="fa fa-sliders"></i> Locks until</label>
        <input type="text" id="node-config-input-behButtonLocksUntil">
    </div>
    <h4>Open command</h4>
    <div class="form-row">
        <label for="node-config-input-inmsgButtonTopicOpen"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-config-input-inmsgButtonTopicOpen" placeholder="Expecting 'openbutton' if left blank">
    </div>
    <div class="form-row">
        <label for="node-config-input-inmsgButtonPayloadOpen"><i class="fa fa-tag"></i> Payload</label>
        <input type="hidden" id="node-config-input-inmsgButtonPayloadOpenType">
        <input type="text" id="node-config-input-inmsgButtonPayloadOpen">
    </div>
    <h4>Close command</h4>
    <div class="form-row">
        <label for="node-config-input-inmsgButtonTopicClose"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-config-input-inmsgButtonTopicClose" placeholder="Expecting 'closebutton' if left blank">
    </div>
    <div class="form-row">
        <label for="node-config-input-inmsgButtonPayloadClose"><i class="fa fa-tag"></i> Payload</label>
        <input type="hidden" id="node-config-input-inmsgButtonPayloadCloseType">
        <input type="text" id="node-config-input-inmsgButtonPayloadClose">
    </div>
    <h3>Window switch</h3>
    <div class="form-row">
        <label for="node-config-input-inmsgWinswitchTopic"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-config-input-inmsgWinswitchTopic" placeholder="Expecting 'switch' if left blank">
    </div>
    <div class="form-row">
        <label for="node-config-input-inmsgWinswitchPayloadOpened"><i class="fa fa-tag"></i> Opened</label>
        <input type="hidden" id="node-config-input-inmsgWinswitchPayloadOpenedType">
        <input type="text" id="node-config-input-inmsgWinswitchPayloadOpened">
    </div>
    <div class="form-row">
        <label for="node-config-input-inmsgWinswitchPayloadTilted"><i class="fa fa-tag"></i> Tilted</label>
        <input type="hidden" id="node-config-input-inmsgWinswitchPayloadTiltedType">
        <input type="text" id="node-config-input-inmsgWinswitchPayloadTilted">
    </div>
    <div class="form-row">
        <label for="node-config-input-inmsgWinswitchPayloadClosed"><i class="fa fa-tag"></i> Closed</label>
        <input type="hidden" id="node-config-input-inmsgWinswitchPayloadClosedType">
        <input type="text" id="node-config-input-inmsgWinswitchPayloadClosed">
    </div>
    <h3>Behavior configuration</h3>
    <div class="form-row">
        <label for="node-config-input-behSunrise"><i class="fa fa-sliders"></i> Sunrise</label>
        <input type="text" id="node-config-input-behSunrise">
    </div>
    <div class="form-row">
        <label for="node-config-input-behSunset"><i class="fa fa-sliders"></i> Sunset</label>
        <input type="text" id="node-config-input-behSunset">
    </div>
</script>




<script type="text/javascript">
    RED.nodes.registerType('shading',{
        category: 'Smart Home',
        color: '#C0DEED',
        inputs: 1,
        outputs: 1,
        icon: "font-awesome/fa-window-maximize",
        defaults: {
            name: {value: ""},
            configOrientation: {type: "shading orientation"},
            configSet: {type: "shading configuration"}
        },
        label: function() {
            return this.name || "Shading"
        }
    });
</script>

<script type="text/html" data-template-name="shading">
    <style>
        .red-ui-editor .form-row label {
            width: 130px
        }
    </style>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Kitchen, Livingroom, ...">
    </div>
    <div class="form-row">
        <label for="node-input-configOrientation"><i class="fa fa-location-arrow"></i> Orientation</label>
        <input type="text" id="node-input-configOrientation">
    </div>
    <div class="form-row">
        <label for="node-input-configSet"><i class="fa fa-sliders"></i> Configuration</label>
        <input type="text" id="node-input-configSet">
    </div>
    <div class="form-tips">
        <h2>Name</h2>
            <p>Give the shading a name. If you have a room with one window, you may want to give it the room's name (like 'livingroom'). If you have more windows in a room, you may append 'left' or 'right'.</p>
        <h2>Orientation</h2>
            <p>This is a configuration set holding the geographical orientation of the window. Use it for all other windows on the same frontside.</p>
        <h2>Configuration</h2>
            <p>This is a set of configuration, which define, how your shading behaves. Use this configuration set for as many blinds as you wish. Create different configuration sets for blinds you want to behave different.</p>
    </div>
</script>

